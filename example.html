<!DOCTYPE html>
<html>
<head>
<title>Example Editor</title>
<link rel="stylesheet" type="text/css" href="dist/contentmint.css">
<link rel="stylesheet" type="text/css" href="vendor/font-awesome/css/font-awesome.min.css">
</head>
<body>
<!--
TODO
    - component hooks (local and global)
    - editor post processing
    - editor types
    - inputting user data with template
    - hook for save function
    - code cleanup (including hook transformation) and storage
    - component drag handles
    - actionbar position when component is at edge of viewport
    - keyboard bindings for toolbar and sidebar views
 -->
<div id="App" v-cloak>
    <toolbar :changes="changes" :user="username" :name="contentName"></toolbar>
    <sidebar :components="components" class="cmint"></sidebar>
    <overlay></overlay>
    <fields v-if="fieldsComponent" :component="fieldsComponent"></fields>
    <actionbar></actionbar>
    <content-template 
        :fields-component="fieldsComponent" 
        :template="template"
        :stage="stage"
        :class="{ scale: !!fieldsComponent }"></content-template>
</div>


<script src="vendor/tinymce/tinymce.min.js"></script>
<script src="dist/vendor.js"></script>
<script src="dist/refactored.js"></script>
<script type="text/javascript">

    Cmint.createToolbarButton({
        text: 'Get Code',
        btnClasses: { 'toolbar-code':true, 'toolbar-btn-fancy': true },
        iconClasses: { 'fa': true, 'fa-code': true },
        callback: function() {
            Cmint.Util.debug('get content code');
        }
    })

    Cmint.createComponentHook('vertical-space', 'Global', function(element, event) {
        if (event === 'editing') {
            $(element).css({
                'margin-bottom': '24px'
            });
        }
    })

    Cmint.createMenu('padding', {
        'Default': '',
        'A little': '1em',
        'A lot': '2.5em'
    })

    Cmint.createField({
        name: 'padding',
        config: {
            type: 'field-dropdown',
            display: 'Padding',
            label: 'Padding',
            input: 'padding',
            menu: 'padding'
        }
    })

    Cmint.createField({
        name: 'color',
        config: {
            type: 'field-text',
            display: 'Color',
            label: 'Color',
            input: 'color',
            help: 'Any valid CSS color value'
        }
    })
    Cmint.createField({
        name: 'bg-color',
        config: {
            type: 'field-text',
            display: 'Background Color',
            label: 'Background Color',
            input: 'bg',
            help: 'Any valid CSS color value'
        }
    })
    Cmint.createField({
        name: 'link-mailto',
        config: {
            type: 'field-group',
            display: 'Email Link',
            hook: 'mailto',
            label: 'Email Link',
            processes: ['mailto'],
            input: [
                { name: 'to', 
                  label: 'The email sendee', 
                  type: 'input' },
                { name: 'subject', 
                  label: 'The email subject line', 
                  type: 'input' },
                { name: 'body', 
                  label: 'The body of your email', 
                  type: 'textarea' }
            ],
        }
    })
    Cmint.createField({
        name: 'link-url',
        config: {
            type: 'field-text',
            display: 'Link URL',
            label: 'Link URL',
            input: 'link',
            help: 'Absolute path including http(s)://',
            check: /^https*:\/\/.+/g,
        }
    })
    Cmint.createField({
        name: 'link-choice',
        config: {
            type: 'field-choice',
            display: 'Link Type',
            label: 'Link Type',
            choices: [
                { name: 'link-url' },
                { name: 'link-mailto' }
            ]
        }
    })

    Cmint.createFieldProcess('onlyred', function(input) {
        return 'red';
    })

    Cmint.createFieldProcess('mailto', function(inputs, component) {
        var output = 'mailto:';
        output += Cmint.Fields.tokenize(inputs.to.value, component) + '?';
        output += 'Subject=' + encode(Cmint.Fields.tokenize(inputs.subject.value, component)) + '&';
        output += 'Body=' + encode(Cmint.Fields.tokenize(inputs.body.value, component));
        function encode(val) { return encodeURIComponent(val); }
        return output;
    })

    Cmint.createComponent({
        template: '\
            <comp :config="config" :style="{\
                    background: config.fields.output.bg,\
                    padding: config.fields.output.padding\
                }">\
                <h1 :style="{color:config.fields.output.color}" data-edit="text"></h1>\
                <a :href="config.fields.output.href" data-edit="link-text"></a>\
            </comp>',
        config: {
            name: 'heading',
            display: 'Heading',
            category: 'Content',
            tokens: [{'text': 'text'}, {'bg': 'bg'}],
            content: { text: 'Lorem Ipsum Headingum', 'link-text': 'email@here' },
            fields: {
                output: { color: 'red', bg: '', padding: '', href: '' },
                list: [
                    { name: 'color', result: 'color' },
                    { name: 'bg-color', result: 'bg' },
                    { name: 'padding', result: 'padding' },
                    { name: 'link-choice', result: 'href' }
                ]
            }
        }
    })

    Cmint.createComponent({
        template: '\
            <comp :config="config">\
                <context :contexts="config.contexts.container" data-context="container"></context>\
            </comp>',
        config: {
            name: 'container',
            display: 'Empty Container',
            category: 'Layout',
            contexts: {
                container: []
            }
        }
    })

    Cmint.Init();
</script>