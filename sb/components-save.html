<!DOCTYPE html><html><head><title>components-add-remove</title>
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<script src="//cdn.tinymce.com/4/tinymce.min.js"></script>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<link rel="stylesheet" type="text/css" href="basic.css">
</head><body>

<div id="EditorToolbar"></div>
<div id="app">
    <button class="btn" @click="load()">Load</button>
    <button class="btn" @click="save()">Save</button>
    <component 
        v-for="comp in comps"
        :is="comp.type"
        :properties="comp.properties">
    </component>
</div>

<script type="text/javascript">

// Components defined by dev
var cTitle = {
    props: ['properties'],
    template: '<h1 :style="properties.css">{{ properties.text }}</h1>'
}
var cHeadingBlock = {
    props: ['properties'],
    template: '<div class="wrapper"><div class="edit-simple" v-html="properties.titleText"></div><hr><div class="edit-robust" v-html="properties.copyText"></div></div>',
    mounted: function() {
        initEditing(this, this.properties.titleText);
    },
}

// Dummy data. Pretend it's saved in a db
var savedComponents = [
    {
        type: 'Heading Block',
        properties: {
            titleText: '<h1>Saved Title Text</h1>',
            copyText: '<p>This copy text was saved in a database</p>'
        }
    }
]

var app = new Vue({
    el: '#app',
    data: {
        comps: [
            {
                type: 'Heading Block',
                properties: {
                    titleText: '<h1>Saved Title Text</h1>',
                    copyText: '<p>This copy text was saved in a database</p>'
                }
            }
        ]
    },
    // Bind human readable name to component objects
    components: {
        'Content Title': cTitle,
        'Heading Block': cHeadingBlock
    },
    methods: {
        load: function() {
            console.log(savedComponents);
            var _self = this;
            _self.comps = [];
            Vue.nextTick(function() {
                _self.comps = savedComponents;
            });
        },
        save: function() {
            savedComponents = this.comps;
            console.log(JSON.stringify(this.comps));
        }
    }
})

function copy(obj) {
    return JSON.parse(JSON.stringify(obj));
}

function editorGlobal(prop) {
    return {
        plugins: 'image table link lists paste textpattern autolink',
        toolbar: 'undo redo bold italic alignleft aligncenter link',
        insert_toolbar: false,
        fixed_toolbar_container: '#EditorToolbar',
        menubar: false,
        inline: true,
        setup: function(editor) {
            editor.on('change', function(e) {
                prop = editor.getContent();
                console.log(prop);
            })
        }
    }
}

function editorSimple(id, prop) {
    var config = editorGlobal(prop);
    config.selector = '#'+id +'.edit-simple, #'+id+' .edit-simple';
    return config;
}

function editorRobust(id, prop) {
    var config = editorGlobal(prop);
    config.selector = '#'+id +'.edit-robust, #'+id+' .edit-robust';
    config.toolbar += ' bullist numlist';
    return config;
}

function initEditing(comp, prop) {
    var $comp = $(comp.$el),
        id = genID(12);
    $comp.attr('id', id);
    tinymce.init(editorSimple(id, prop));
    tinymce.init(editorRobust(id, prop));
}


function random(min, max) {
    return Math.floor(Math.random() * (max - min + 1) + min);
}
  
function genID(num) {
    var id = 'ID-', i = 1;
    while (i <= num) {
        if (i % 2 === 0) {
            id += String.fromCharCode(random(65, 90));
        } else {
            id += String.fromCharCode(random(48, 57));
        }
        i++;
    }
    return id;
}


</script></body></html>